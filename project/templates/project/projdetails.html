{% extends 'project/base.html' %}

{% block title %}
{{block.super}} - Project details
{% endblock %}


{% block contents %}
    <h2>{{project.name}}</h2>
    <ul>
    {% for sub in subs %}
        <li>
        <a href="{{sub.project.get_absolute_url}}">{{sub.project.name}}</a>
        </li>
    {% endfor %}
    
    {% if new_tasks %}
    <h3>Recent tasks</h3>
    <table>
        <thead>
            <tr>
            <td>Task
            </td>
            <td>Expected Start Date
            </td>
            <td>
                Expected End Date
            </td>
            <td>
                User Responsible
            </td>
            <td>
                Edit
            </td>
            <td>
                Mark Done
            </td>
            </tr>
        </thead>
        <tbody>
    {% for task in new_tasks %}
        
        <tr class={% cycle "odd" "even" %}>
        
        <td><a href="{{task.get_absolute_url}}">{{task.name}}</a></td>
        <td>{{task.expected_start_date|date}}</td>
        <td>{{task.expected_end_date|date}}</td>
        <td>{{task.user_responsible}}</td>
        <td><a href="{{task.edit_url}}">Edit</a></td>
        {% include 'project/markdone_controls.html' %}
        </tr>
        
    {% endfor %}
        </tbody>
    </table>
    {% endif %}
    
    
    {% if overdue_tasks %}
    <h3>Overdue tasks</h3>
    <table>
        <thead>
            <tr>
            <td>Task
            </td>
            <td>Expected Start Date
            </td>
            <td>
                Expected End Date
            </td>
            <td>
                User Responsible
            </td>
            <td>
                Edit
            </td>
            <td>
                Mark Done
            </td>           
            </tr>
        </thead>
        <tbody>
    {% for task in overdue_tasks %}
        
        <tr class={% cycle "odd" "even" %}>
        
        <td><a href="{{task.get_absolute_url}}">{{task.name}}</a></td>
        <td>{{task.expected_start_date|date}}</td>
        <td>{{task.expected_end_date|date}}</td>
        <td>{{task.user_responsible}}</td>
        <td><a href="{{task.edit_url}}">Edit</a></td>
        {% include 'project/markdone_controls.html' %}         
        </tr>
        
    {% endfor %}
        </tbody>
    </table>
    {% endif %}   
    
    </ul>
    
    <div id="inviteform">
        <form action="." method="POST">
            <fieldset>
                <legend>Invite a User</legend>
            {{inviteform.as_p}}
            <input type="SUBMIT" name="invite" value="Invite User" />
            </fieldset>
        </form>
    </div>
    
    <div id="taskform">
        <form action="." method="POST">
            <fieldset>
                <legend>Add a task</legend>
            {{taskform.as_p}}
            <input type="SUBMIT" name="task" value="Add a task" />
            </fieldset>
        </form>
    </div>    
{% endblock %}

{% block sidebar %}
    
    You are looking at details for project {{project.name}}.
    This project has {{project.task_set.all.count}} tasks.
    {% if project.invited_users %}
    <div><h3>Pending users.</h3>
        <ul>
        {% for user in project.invited_users %}
           <li> {{user.user.username}}</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}
    <div dojoType="dojo.data.ItemFileReadStore"
             url="/projson/{{project.shortname}}/" jsid="popStore" query="{type:'toptask'}"/>

        <div dojoType="dijit.Tree" store="popStore" labelAttr="name" label="Pop Tarts"></div>    
{% endblock %}